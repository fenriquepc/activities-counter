@page "/proximasactividades"
@using System.Globalization
@inject IActivitiesManager ActivitiesManager
@inject IJSRuntime JS

<PageTitle>Próximas actividades</PageTitle>

<div class="next-activities">
<h1>Próximas actividades</h1>

@if (_activities == null)
{
	<p><em>Cargando...</em></p>
}
else
{
	<table class="activities-table">
		<tbody>
			@foreach (var activity in _activities)
			{
				<tr>
					<td>@GetTimeText(activity.Date)</td>
						<td>
							<HxTooltip Text="Solo para mayores de edad">
								<span class="material-symbols-outlined adults-only" hidden="@(!activity.AdultsOnly)">18_up_rating</span>
							</HxTooltip>
						</td>
						<td>
							<a @onclick="() => ShowModal(activity)">@activity.Name</a>
							
					</td>
					<td>@activity.AvailableCapacity</td>
					<td>
						<button class="btn btn-success" @onclick="@(e => ActivitiesManager.AddParticipant(activity, "sfdfg"))">Añadir</button>
					</td>
				</tr>
			}
		</tbody>
	</table>
}
</div>
@code {
	[CascadingParameter] 
	public IModalService Modal { get; set; } = default!;

	private IEnumerable<Activity> _activities = default!;

	protected override async Task OnInitializedAsync()
	{
		_activities = await ActivitiesManager.GetNextActivitiesAsync();
	}

	private void ShowModal(Activity activity)
	{
		var parameters = new ModalParameters()
			.Add(nameof(EditActivity.Activity), activity);
		var options = new ModalOptions()
		{
			Position = ModalPosition.Middle
			//Class = "edit-activity-modal"
		};

		var moviesModal = Modal.Show<EditActivity>("Editar actividad", parameters, options);
	}

	private string GetTimeText(DateTime date)
	{
		var result = date.ToString("HH:mm");

		if (date.Date == DateTime.Now.Date)
			return result;

		var ci = new CultureInfo("Es-Es");
		var dayText = ci.DateTimeFormat.GetDayName(date.DayOfWeek).Substring(0, 3);
		return $"{result} ({dayText})";
	}
}