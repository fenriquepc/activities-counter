@using ActivitiesCounter.Components
@inject ActivitiesManager ActivitiesManager

<div class="activity-options">
	<div class="dropdown">
		<span class="options-button p-0" data-bs-toggle="dropdown">
			<i class="fa-solid fa-gear options-button"></i>
		</span>
		<ul class="dropdown-menu">
			<li class="dropdown-item" @onclick="EditActivity">
				<i class="fa-regular fa-pen-to-square"></i>
				Editar actividad
			</li>
			<li class="dropdown-item" @onclick="ShowParticipants">
				<i class="fa-solid fa-user-gear"></i>
				Detalles de participantes
			</li>
			<li class="dropdown-item" @onclick="Remove">
				<i class="fa-solid fa-trash-can"></i>
				Borrar actividad
			</li>
		</ul>
	</div>
</div>

@code {
	[CascadingParameter]
	public IModalService ModalService { get; set; } = default!;

	[CascadingParameter]
	private Activity Activity { get; set; }

	[CascadingParameter(Name = "ActivitiesChanged")]
	private Action ActivitiesChanged { get; set; }

	private IModalReference _modal;

	private async Task EditActivity()
	{
		var parameters = new ModalParameters()
			.Add(nameof(Pages.EditActivity.Activity), Activity);

		_modal = ModalService.Show<EditActivity>("Editar actividad", parameters, new()
			{
				Position = ModalPosition.Middle,
			});

		var result = await _modal.Result;
		if (result.Confirmed)
		{
			Activity = result.Data as Activity;
			ActivitiesChanged();
		}

		_modal.Close();
	}

	private void ShowParticipants()
	{
		var parameters = new ModalParameters()
			.Add(nameof(Participants.Activity), Activity);

		_modal = ModalService.Show<Participants>($"Participantes de {Activity.Name}", parameters, new()
			{
				Position = ModalPosition.Middle
			});
	}

	private async Task Remove()
	{
		var parameters = new ModalParameters()
			.Add(nameof(ConfirmModal.Message), "Â¿Seguro que quieres borrar la actividad?");

		_modal = ModalService.Show<ConfirmModal>("Confirmar borrado", parameters, new()
			{
				Position = ModalPosition.Middle,
			});

		var result = await _modal.Result;
		if (result.Confirmed)
		{
			await ActivitiesManager.RemoveActivityAsync(Activity);
			ActivitiesChanged();
		}

		_modal.Close();
	}
}
